---
phase: 07-data-layer
plan: 02
type: execute
wave: 2
depends_on:
  - "07-01"
files_modified: []
autonomous: false
requirements:
  - DATA-01
  - DATA-02
  - DATA-03

must_haves:
  truths:
    - "App launches without errors after the sheet rename from 'Sheet1' to 'Part 1'"
    - "Equipment data (Electrical, Mechanical, Miscellaneous) displays correctly in the running app"
    - "tds_lookup and depth_lookup DataFrames are in memory and accessible to callbacks"
  artifacts:
    - path: "src/data/loader.py"
      provides: "Confirmed working loader with Part 1 + Part 2 support"
      exports: ["load_data"]
  key_links:
    - from: "app.py"
      to: "src/data/loader.load_data()"
      via: "DATA = load_data() at module level"
      pattern: "DATA = load_data"
---

<objective>
Human verification that the updated data layer works end-to-end: app starts without errors, equipment data renders in the UI, and the lookup DataFrames are confirmed in memory.

Purpose: Automated tests verify loader.py in isolation. This checkpoint confirms the full app startup (app.py importing loader, Dash layout building from DATA) works correctly with the renamed sheet and new lookup tables.

Output: Confirmed Phase 7 success — data layer is ready for Phase 8 slider wiring.
</objective>

<execution_context>
@C:/Users/kevin/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/kevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-layer/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Smoke-test full app startup</name>
  <files></files>
  <action>
Run the app startup in import mode (not as a server) to confirm no exceptions are raised and all 6 data keys are present in memory:

```bash
cd "C:/Users/kevin/Downloads/Desalination Project Vibe Code"
python -c "
import sys
sys.argv = ['app']   # Prevent __main__ block from running

# Import app.py — this triggers load_data() at module level
import app as application

if application.DATA is None:
    print('FAIL: DATA is None — app would show error page')
    print('Error:', getattr(application, '_error_msg', 'unknown'))
    sys.exit(1)

data = application.DATA
print('Keys in DATA:', list(data.keys()))

required_keys = ['electrical', 'mechanical', 'miscellaneous', 'battery_lookup', 'tds_lookup', 'depth_lookup']
for key in required_keys:
    assert key in data, f'Missing key: {key}'
    df = data[key]
    print(f'  {key}: shape={df.shape}')

print()
print('PASS: App startup OK — all 6 data keys present in memory')
print(f'tds_lookup range: {data[\"tds_lookup\"][\"tds_ppm\"].min()}–{data[\"tds_lookup\"][\"tds_ppm\"].max()} PPM')
print(f'depth_lookup range: {data[\"depth_lookup\"][\"depth_m\"].min()}–{data[\"depth_lookup\"][\"depth_m\"].max()} m')
"
```

Expected: no exceptions, all 6 keys listed, tds_lookup range 0-1900, depth_lookup range 0-1900.

If the startup fails, diagnose the error output and fix loader.py before proceeding to the checkpoint.
  </action>
  <verify>
    <automated>cd "C:/Users/kevin/Downloads/Desalination Project Vibe Code" && python -c "
import sys
sys.argv = ['app']
import app as application
assert application.DATA is not None, 'DATA is None'
data = application.DATA
for k in ['electrical','mechanical','miscellaneous','battery_lookup','tds_lookup','depth_lookup']:
    assert k in data, f'Missing: {k}'
print('Smoke test PASS')
"
</automated>
  </verify>
  <done>python -c "import app" completes without raising any exception; application.DATA is not None; all 6 expected keys are present.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    - loader.py updated to read from "Part 1" sheet (DATA-01)
    - _parse_part2_lookups() added — returns tds_lookup and depth_lookup DataFrames (DATA-02, DATA-03)
    - load_data() now returns 6 keys: electrical, mechanical, miscellaneous, battery_lookup, tds_lookup, depth_lookup
    - Automated smoke test confirmed no startup errors
  </what-built>
  <how-to-verify>
    1. Start the app: `python app.py` (from project root)
    2. Browser opens at http://127.0.0.1:8050
    3. Confirm: the app loads the Overview tab (no red error page)
    4. Navigate to the Electrical system page — confirm equipment items are listed (not empty)
    5. Navigate to the Mechanical system page — confirm equipment items are listed (not empty)
    6. No console errors visible in the terminal output
    7. (Optional) Open your browser dev tools console — no JavaScript fetch errors expected
  </how-to-verify>
  <resume-signal>Type "approved" if the app loads correctly. Or describe any issues (e.g., "error page shows", "mechanical tab is empty").</resume-signal>
</task>

</tasks>

<verification>
Phase 7 is complete when:
1. Automated smoke test passes (Task 1)
2. Human confirms app loads without error page (Task 2)
3. Equipment data visible in both Electrical and Mechanical system tabs

The tds_lookup and depth_lookup DataFrames are in DATA — they will be wired to slider callbacks in Phase 8. No UI changes are needed in Phase 7; the lookup tables just need to exist in memory.
</verification>

<success_criteria>
1. App starts without error (no error page) after "Sheet1" → "Part 1" rename — DATA-01
2. Equipment data displays correctly in the running UI — DATA-01
3. tds_lookup (20 rows, TDS 0–1900 PPM) accessible in app.DATA — DATA-02
4. depth_lookup (20 rows, Depth 0–1900 m) accessible in app.DATA — DATA-03
5. Phase 8 can proceed: DATA['tds_lookup'] and DATA['depth_lookup'] are available for callback wiring
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-layer/07-02-SUMMARY.md` with:
- Confirmation that the app loaded without errors
- The final shape of app.DATA (all 6 keys and their dimensions)
- Note confirming tds_lookup and depth_lookup are available for Phase 8 slider callbacks
- Any deviations or issues encountered
</output>
