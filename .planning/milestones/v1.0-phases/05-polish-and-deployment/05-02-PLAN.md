---
phase: 05-polish-and-deployment
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/layout/charts.py
  - src/layout/hybrid_builder.py
  - src/layout/system_view.py
  - src/layout/overview.py
  - src/layout/scorecard.py
  - src/layout/shell.py
  - src/layout/equipment_grid.py
autonomous: false
requirements: [VIS-02, DEP-01]

must_haves:
  truths:
    - "A student unfamiliar with the tool can identify what to do first within 30 seconds of opening the dashboard"
    - "Cost chart y-axis shows dollar-abbreviated labels ($1M, $500k) and hover tooltips show full precision ($1,234,567)"
    - "All chart axes have labeled units and hover tooltips show formatted values"
    - "Content groups are visually separated by subtle cards with light shadows"
    - "Hybrid builder shows an instruction line above the pipeline slots"
    - "Running python app.py on a clean state starts the app with no errors"
  artifacts:
    - path: "src/layout/charts.py"
      provides: "Chart axis formatting with tickprefix and tickformat"
      contains: "tickformat"
    - path: "src/layout/hybrid_builder.py"
      provides: "Instruction line above pipeline slots"
      contains: "Select one piece of equipment for each process stage"
    - path: "src/layout/system_view.py"
      provides: "Consistent card wrappers around content sections"
      contains: "shadow-sm"
  key_links:
    - from: "src/layout/charts.py"
      to: "Plotly figure y-axis"
      via: "update_layout yaxis dict"
      pattern: 'tickprefix.*tickformat'
    - from: "src/layout/hybrid_builder.py"
      to: "pipeline row"
      via: "html.P instruction text above dropdowns"
      pattern: "Select one piece of equipment"
---

<objective>
Visual polish audit, chart axis formatting, hybrid instruction line, and deployment verification.

Purpose: Satisfies VIS-02 (easy navigation for unfamiliar students) and DEP-01 (clean single-command startup). This is the final refinement pass across all UI components — no new features, only consistency and clarity improvements.
Output: Polished charts with proper axis labels, card wrappers on all content sections, hybrid builder instruction line, verified clean startup.
</objective>

<execution_context>
@C:/Users/kevin/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/kevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-polish-and-deployment/05-CONTEXT.md
@.planning/phases/05-polish-and-deployment/05-RESEARCH.md
@.planning/phases/05-polish-and-deployment/05-01-SUMMARY.md
@src/layout/charts.py
@src/layout/hybrid_builder.py
@src/layout/system_view.py
@src/layout/overview.py
@src/layout/scorecard.py
@src/layout/shell.py
@src/layout/equipment_grid.py
@assets/custom.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Chart axis formatting and hybrid builder instruction line</name>
  <files>src/layout/charts.py, src/layout/hybrid_builder.py</files>
  <action>
In charts.py — update the chart figure builder functions:

1. **Cost over time chart** (`build_cost_chart` or equivalent):
   - Add `tickprefix="$"` and `tickformat="~s"` to the yaxis dict in update_layout. The d3 SI format "~s" produces "1M", "500k" labels. Combined with tickprefix, axes show "$1M", "$500k".
   - Verify the existing hovertemplate already uses `$,.0f` format (full precision dollars). If so, no hover change needed. If not, update to: `hovertemplate=f"{name}: %{{y:$,.0f}} at Year %{{x}}&lt;extra&gt;&lt;/extra&gt;"`

2. **Land area bar chart** (`build_land_chart` or equivalent):
   - Check the actual data range first by reading the data values used. If max land area values are under 5,000 m², leave axis format as default (values are already readable). If over 10,000 m², add `tickformat="~s"`.
   - Ensure yaxis_title includes units: "Area (m2)" or similar. If already present, no change.
   - Verify hover shows full precision with units.

3. **Turbine count bar chart**: Already has `yaxis=dict(dtick=1)` — no change needed. Confirm axis title includes "Wind Turbines" or similar unit label.

4. **Energy pie chart**: No axes. Confirm hover shows `%{percent}` and labels are full stage names (not truncated). No change expected.

5. **All 4 charts**: Verify `margin` dict provides enough space for axis labels with the new formatting. If cost chart left margin is less than 60px, increase to 70-80px to accommodate "$1.2M" labels.

In hybrid_builder.py — add instruction line:
1. In the `make_hybrid_builder()` function, add an `html.P` element ABOVE the pipeline row (the row of dropdowns):
```python
html.P(
    "Select one piece of equipment for each process stage",
    className="text-muted small mb-2",
),
```
2. This is the exact text specified in CONTEXT.md locked decisions. Do not paraphrase.

CONTEXT.md note on K/M casing: The d3 "~s" format uses lowercase "k" for thousands (SI convention). This is acceptable — chart axes use lowercase k/M while the scorecard text uses fmt_cost() with uppercase K/M. Different UI contexts, both correct per RESEARCH.md recommendation.
  </action>
  <verify>
Run `python app.py`. Check cost chart: y-axis should show "$500k", "$1M" style labels. Hover over a data point: tooltip should show full "$1,234,567" format. Check land chart and turbine chart for proper axis titles with units. Navigate to Hybrid tab: instruction line "Select one piece of equipment for each process stage" should appear above the 5 dropdown slots.
  </verify>
  <done>Cost chart y-axis shows abbreviated dollar labels. All chart axes have unit labels. Hover tooltips show full precision values. Hybrid builder shows instruction text above the pipeline slots.</done>
</task>

<task type="auto">
  <name>Task 2: Visual audit and card wrapper consistency across all layout files</name>
  <files>src/layout/system_view.py, src/layout/overview.py, src/layout/scorecard.py, src/layout/shell.py, src/layout/equipment_grid.py</files>
  <action>
Conduct a thorough visual audit of every layout file. For each file, read it fully, check against the audit checklist from RESEARCH.md, and apply fixes. This is the user's first visual pass — be thorough.

**system_view.py:**
- Verify the scorecard card wrapper from Plan 01 is in place (dbc.Card with shadow-sm wrapping scorecard-container + comparison-text)
- Ensure chart section has consistent card wrapping. If individual charts are already in cards (shadow-sm), good. If the chart grid/row lacks consistent spacing, add mb-3 margins.
- Ensure equipment section has consistent padding/margins. If equipment_grid output is not wrapped in a card, consider adding a subtle card wrapper for visual consistency.
- Add `className="no-print"` to any remaining interactive elements that should not appear in print (e.g., "Back to Overview" button if it exists)

**overview.py:**
- Verify three system cards already have `className="h-100 shadow-sm"` (from prior phases — no change expected)
- Read the card description text — ensure it is clear for a student who has never used the tool. The landing page is the first thing students see; it should immediately communicate: "click a system to explore it"
- If card descriptions are vague, improve them to be direct and informative

**scorecard.py:**
- Verify RAG dot size (12px) is legible. If dots look too small, increase to 14-16px.
- Verify "Best Overall" summary row is present and clear
- Ensure fmt_cost() values display correctly (uppercase K/M)

**shell.py:**
- Verify sidebar tabs are text-only labels (no icons) — per CONTEXT.md locked decision
- Verify landing view opens on overview with scorecard visible (default tab = overview)
- Verify sidebar is visible by default (sidebar-collapsed store data=False)
- Ensure the navbar has a clear app title visible to students

**equipment_grid.py:**
- Verify equipment accordion has consistent styling
- If accordion items lack visual separation, add subtle borders or spacing

**General across all files:**
- Ensure consistent use of dbc.Card with shadow-sm for content groups
- Ensure consistent margin-bottom (mb-3) between major sections
- No orphaned unstyled divs that break visual flow
- Colors match SYSTEM_COLORS from config.py throughout

Do NOT change any functional behavior. This task is purely visual consistency.
  </action>
  <verify>
Run `python app.py`. Open the dashboard and visually inspect: (1) overview page has three clear system cards, (2) clicking a system shows scorecard in a card with shadow, (3) charts have consistent card styling, (4) equipment section has consistent styling, (5) hybrid builder has the instruction line, (6) no visual inconsistencies (orphaned borders, missing shadows, inconsistent spacing). Run `python -c "import app"` to confirm clean import with no warnings.
  </verify>
  <done>All content sections wrapped in consistent subtle cards. Overview cards are clear and informative. Scorecard, charts, and equipment sections have uniform shadow-sm styling. No visual inconsistencies across the dashboard.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual and functional verification</name>
  <what-built>Complete visual polish pass: export/print feature, chart axis formatting with K/M dollar labels, card wrappers on all content sections, hybrid builder instruction line, and overall visual consistency audit.</what-built>
  <how-to-verify>
1. Open http://127.0.0.1:8050 — the overview page should load with three clear system cards. Can you tell what to do first within 30 seconds?
2. Click "Mechanical" — verify the scorecard appears in a subtle card with shadow. The Export/Print button should be visible at the top of the scorecard section.
3. Scroll to the charts — cost chart y-axis should show "$500k", "$1M" style abbreviated labels. Hover over a data point to confirm full "$1,234,567" precision in the tooltip.
4. Check land area chart and turbine chart — axes should have unit labels ("Area (m2)", "Wind Turbines" or similar).
5. Click "Export / Print" — browser print dialog should open. In print preview: scorecard and charts visible, sidebar/navbar/sliders/buttons hidden. Chrome should show portrait/landscape Layout option.
6. Cancel print dialog. Navigate to "Hybrid" tab — instruction line "Select one piece of equipment for each process stage" should appear above the 5 dropdown slots.
7. Fill all 5 hybrid slots — charts and scorecard should update. Click "Export / Print" again — print preview should show hybrid data in scorecard and charts, but NOT the hybrid builder dropdowns.
8. Close and restart: `python app.py` — confirm clean startup with no errors or warnings.
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `python app.py` starts cleanly with no errors
2. Overview page is immediately understandable for new students
3. All charts have proper axis labels with units
4. Cost chart uses K/M dollar abbreviations on y-axis
5. Export/print works and shows only report-relevant content
6. Hybrid builder has instruction text
7. All content sections have consistent card styling
8. DEP-01 verified: single-command startup works
</verification>

<success_criteria>
- VIS-02 satisfied: dashboard is easy to navigate for unfamiliar students (clear hierarchy, instruction text, consistent styling)
- DEP-01 satisfied: `python app.py` starts cleanly
- All chart axes labeled with units, dollar values abbreviated, tooltips show full precision
- Visual consistency across all content sections (cards, shadows, spacing)
- Human verification confirms the above
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish-and-deployment/05-02-SUMMARY.md`
</output>
