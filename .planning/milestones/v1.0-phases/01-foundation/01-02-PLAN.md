---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - app.py
  - src/layout/__init__.py
  - src/layout/shell.py
  - src/layout/error_page.py
  - assets/custom.css
autonomous: false
requirements:
  - DEP-01
  - DATA-02

must_haves:
  truths:
    - "Running `python app.py` starts a Dash server and auto-opens a browser tab to localhost:8050"
    - "The app displays a sidebar navigation with a collapsible toggle and a top header bar titled 'Wind-Powered Desalination Dashboard'"
    - "If data.xlsx loads successfully, the app shows the shell layout with sidebar and empty content area — no success message"
    - "If data.xlsx is missing or corrupt, the app shows a full-page error with a human-readable message and an expandable details section"
    - "Validation results are logged to the terminal when `python app.py` runs"
  artifacts:
    - path: "app.py"
      provides: "Entry point: loads data, creates Dash app, opens browser, runs server"
      min_lines: 25
    - path: "src/layout/shell.py"
      provides: "App shell with header, collapsible sidebar, content area"
      exports: ["create_layout"]
      min_lines: 40
    - path: "src/layout/error_page.py"
      provides: "Full-page error component with expandable details"
      exports: ["create_error_page"]
      min_lines: 15
    - path: "assets/custom.css"
      provides: "Sidebar toggle button and transition styles"
      min_lines: 5
  key_links:
    - from: "app.py"
      to: "src/data/loader.py"
      via: "load_data() import and call"
      pattern: "from src\\.data\\.loader import load_data"
    - from: "app.py"
      to: "src/layout/shell.py"
      via: "create_layout import"
      pattern: "from src\\.layout\\.shell import create_layout"
    - from: "app.py"
      to: "src/layout/error_page.py"
      via: "create_error_page import on failure"
      pattern: "from src\\.layout\\.error_page import create_error_page"
    - from: "src/layout/shell.py"
      to: "src/config.py"
      via: "SYSTEM_COLORS import for future use"
      pattern: "from src\\.config import"
---

<objective>
Build the app shell and entry point: Dash app with FLATLY theme, collapsible sidebar navigation, top header bar, full-page error handling, and auto-open browser on startup.

Purpose: This creates the visible, runnable application that students will interact with. It wires together the data layer (Plan 01) with the UI shell, completing the Phase 1 foundation.
Output: `app.py`, `src/layout/shell.py`, `src/layout/error_page.py`, `assets/custom.css`
</objective>

<execution_context>
@C:/Users/kevin/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/kevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create app shell layout with collapsible sidebar and error page</name>
  <files>
    src/layout/__init__.py
    src/layout/shell.py
    src/layout/error_page.py
    assets/custom.css
  </files>
  <action>
Create `src/layout/__init__.py` — empty init file.

Create `src/layout/shell.py` with a `create_layout(data)` function:
- Takes the data dict from `load_data()` as parameter (for future use by child components)
- Returns a Dash `html.Div` containing:
  1. `dcc.Store(id="sidebar-collapsed", data=False)` — persists sidebar state
  2. **Top header bar**: `dbc.Navbar` with:
     - A toggle button (id="sidebar-toggle") with hamburger icon text (use the text character, not an emoji)
     - Title text: "Wind-Powered Desalination Dashboard" as navbar brand
     - `color="primary"`, `dark=True`
  3. **Flex container** (`display: flex`) containing:
     - **Sidebar** (id="sidebar"): `html.Div` with:
       - Width: 220px (use CSS variable or inline style)
       - Background: `#f8f9fa` (light gray)
       - `dbc.Nav` with vertical pills containing:
         - `dbc.NavLink("Overview", href="/", active="exact")`
         - Comment noting future phases add nav items here
       - CSS transition on width for smooth collapse animation (0.2s)
       - `overflow: hidden` to hide content when collapsed
     - **Content area** (id="page-content"): `html.Div` with `flex: 1`, padding `1.5rem`
       - For Phase 1, show a simple placeholder: `html.P("Dashboard content will appear here as features are built.")`

Create a Dash callback in `shell.py` for sidebar toggle:
- Input: `"sidebar-toggle"` n_clicks
- State: `"sidebar-collapsed"` data
- Output: `"sidebar"` style (update width to 0px when collapsed, 220px when expanded), `"sidebar-collapsed"` data
- Toggle logic: flip the boolean, set width accordingly

Create `src/layout/error_page.py` with a `create_error_page(error, details="")` function:
- Takes error message string and optional details string
- Returns a full-page `html.Div` (minHeight 100vh, padded top) containing:
  - `dbc.Container` with centered `dbc.Row`/`dbc.Col` (width=8):
    - `html.H2("Unable to Load Dashboard", className="text-danger mt-5")`
    - `html.P("The dashboard could not start because the data file could not be read.")`
    - `dbc.Alert(error, color="danger")` — shows the high-level error
    - `dbc.Accordion` with one `dbc.AccordionItem` titled "Details (for technical users)" containing `html.Pre(details)` — only rendered if details is non-empty
    - `start_collapsed=True` on the accordion so details are hidden by default

Create `assets/custom.css` with minimal styles:
- Sidebar toggle button: remove default button border, set cursor pointer, font-size for hamburger icon, color white
- Sidebar transition: `transition: width 0.2s ease` (applied via inline style in shell.py, but add any supplementary CSS here)
- Ensure sidebar items are not visible when sidebar width is 0 (overflow hidden handles this)

Use `from dash import html, dcc, callback, Input, Output, State` (Dash 4.0 import style).
Use `import dash_bootstrap_components as dbc`.
  </action>
  <verify>
Run: `python -c "from src.layout.shell import create_layout; from src.layout.error_page import create_error_page; print('shell OK'); print('error_page OK')"`
Confirm both imports succeed.
  </verify>
  <done>
`create_layout()` returns a complete Dash component tree with header, collapsible sidebar, and content area. `create_error_page()` returns a full-page error component with expandable details. Sidebar toggle callback is registered. `assets/custom.css` exists with sidebar button styles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create app.py entry point with data loading, error handling, and browser auto-open</name>
  <files>
    app.py
  </files>
  <action>
Create `app.py` as the single entry point:

1. **Import and load data** at module level (not inside callbacks):
   ```python
   from src.data.loader import load_data
   from src.layout.shell import create_layout
   from src.layout.error_page import create_error_page
   ```
   - Wrap `load_data()` in try/except at module level
   - On success: print `"[OK] data.xlsx loaded — all sections parsed successfully"` to stdout, store result in `DATA`
   - On `FileNotFoundError`: print `f"[ERROR] {e}"` to stderr, set `DATA = None`, capture error string and traceback
   - On `ValueError`: print `f"[ERROR] {e}"` to stderr, set `DATA = None`, capture error string and traceback

2. **Create Dash app**:
   ```python
   import dash
   import dash_bootstrap_components as dbc
   app = dash.Dash(__name__, external_stylesheets=[dbc.themes.FLATLY])
   app.title = "Wind-Powered Desalination Dashboard"
   ```

3. **Set layout conditionally**:
   - If `DATA is not None`: `app.layout = create_layout(DATA)`
   - If `DATA is None`: `app.layout = create_error_page(error=error_msg, details=detail_str)`
     - `error_msg`: high-level message (e.g., "data.xlsx not found" or "Missing sections: {names}")
     - `detail_str`: full traceback string for the expandable details section

4. **Main block** with auto-open browser:
   ```python
   if __name__ == "__main__":
       import threading
       import webbrowser
       PORT = 8050
       threading.Timer(1.0, lambda: webbrowser.open(f"http://127.0.0.1:{PORT}")).start()
       app.run(debug=False, port=PORT)
   ```
   - Use `debug=False` to prevent double browser tab (Flask reloader issue)
   - Use `127.0.0.1` not `localhost` (avoids DNS resolution delay on some systems)

5. **Suppress callback exceptions** for multi-page apps (future phases):
   ```python
   app.config.suppress_callback_exceptions = True
   ```
   This is needed because the sidebar toggle callback references IDs that exist in the layout but Dash validates eagerly.
  </action>
  <verify>
1. Run: `pip install -r requirements.txt` (install dependencies if not already)
2. Run: `python app.py` — confirm it starts, opens browser, shows the dashboard shell with header and sidebar
3. Click the sidebar toggle button — confirm sidebar collapses and expands
4. Check terminal output — confirm "[OK] data.xlsx loaded" message appears
5. Stop the server (Ctrl+C)
  </verify>
  <done>
`python app.py` starts the Dash server on port 8050, auto-opens a browser tab, displays the app shell with "Wind-Powered Desalination Dashboard" header and collapsible sidebar. Terminal shows validation log. If data.xlsx is missing/corrupt, shows error page instead.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify app launches and displays correctly</name>
  <files>app.py</files>
  <action>
Human verification checkpoint — no automated action. Claude presents the running app for the user to visually inspect.

What was built: Complete Phase 1 foundation — data parser, app shell with collapsible sidebar, error handling, and auto-open browser.
  </action>
  <verify>
1. Open a terminal in the project directory
2. Run `pip install -r requirements.txt` (if not already done)
3. Run `python app.py`
4. Confirm: Browser opens automatically to http://127.0.0.1:8050
5. Confirm: Top header bar shows "Wind-Powered Desalination Dashboard" on a blue/primary background
6. Confirm: Left sidebar shows "Overview" nav link on a light gray background
7. Click the hamburger toggle button in the header — confirm sidebar smoothly collapses (content area expands)
8. Click again — confirm sidebar reappears
9. Check terminal — confirm "[OK] data.xlsx loaded — all sections parsed successfully" message
10. Stop the server (Ctrl+C)
11. (Optional) Temporarily rename data.xlsx, run `python app.py` again, confirm error page appears with "Unable to Load Dashboard" message and expandable details. Rename it back.
  </verify>
  <done>User confirms the app launches correctly, sidebar toggles, header displays, and error page works when data is missing.</done>
</task>

</tasks>

<verification>
1. `python app.py` starts without errors and opens browser to the dashboard
2. Dashboard displays header bar, collapsible sidebar, and content area
3. Sidebar toggle works (collapses/expands smoothly)
4. Terminal shows data validation log
5. Error page displays correctly when data.xlsx is missing
6. All imports resolve: `from src.data.loader import load_data`, `from src.config import SYSTEM_COLORS`
</verification>

<success_criteria>
- `python app.py` launches the app with no errors and auto-opens browser
- FLATLY Bootstrap theme applied (clean, flat, professional appearance)
- Header bar with project title visible
- Sidebar with "Overview" link, collapsible via toggle button
- Silent success on data load (no success toast/modal)
- Full-page error with expandable details when data.xlsx is missing/corrupt
- Terminal logs validation status
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
