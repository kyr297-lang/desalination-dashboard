---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/__init__.py
  - src/config.py
  - src/data/__init__.py
  - src/data/loader.py
  - requirements.txt
autonomous: true
requirements:
  - DATA-01
  - DATA-02
  - DATA-03

must_haves:
  truths:
    - "data.xlsx is parsed into three DataFrames (electrical, mechanical, miscellaneous) plus a battery_lookup DataFrame without crashing"
    - "Non-numeric values (string costs, 'indefinite' lifespans, None quantities) are preserved faithfully — no coercion errors"
    - "Missing data.xlsx or missing section headers raises a clear, descriptive error (not a traceback)"
    - "System color map provides consistent hex colors for Mechanical, Electrical, and Hybrid"
  artifacts:
    - path: "src/data/loader.py"
      provides: "Excel section-based parser returning dict of DataFrames"
      exports: ["load_data"]
      min_lines: 60
    - path: "src/config.py"
      provides: "SYSTEM_COLORS dict, DATA_FILE path constant"
      exports: ["SYSTEM_COLORS"]
      min_lines: 10
    - path: "requirements.txt"
      provides: "Pinned dependency versions"
      min_lines: 4
  key_links:
    - from: "src/data/loader.py"
      to: "data.xlsx"
      via: "openpyxl workbook open"
      pattern: "openpyxl\\.load_workbook"
    - from: "src/data/loader.py"
      to: "pandas DataFrame"
      via: "pd.DataFrame constructor"
      pattern: "pd\\.DataFrame"
---

<objective>
Build the data layer: parse data.xlsx into structured DataFrames, validate that all three sections exist and parse correctly, define the system color map, and pin project dependencies.

Purpose: Every other feature depends on correctly parsed data and consistent configuration. This plan establishes the foundation that all subsequent plans import from.
Output: `src/data/loader.py`, `src/config.py`, `requirements.txt`, package init files
</objective>

<execution_context>
@C:/Users/kevin/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/kevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project structure, config, and requirements.txt</name>
  <files>
    src/__init__.py
    src/config.py
    src/data/__init__.py
    requirements.txt
  </files>
  <action>
Create the project directory structure:
- `src/__init__.py` — empty init file
- `src/data/__init__.py` — empty init file

Create `src/config.py` with:
- `DATA_FILE` — path to `data.xlsx` using `Path(__file__).parent.parent / "data.xlsx"` (relative to project root)
- `SYSTEM_COLORS` dict mapping system names to academic muted hex colors:
  - `"Mechanical": "#5B8DB8"` (muted steel blue)
  - `"Electrical": "#D4854A"` (muted terra cotta)
  - `"Hybrid": "#6BAA75"` (muted sage green)
- Add a code comment explaining the palette is an academic muted triad, accessible for most forms of colorblindness
- `RAG_COLORS` dict for scorecard indicators (separate from system colors):
  - `"red": "#DC3545"`, `"yellow": "#FFC107"`, `"green": "#28A745"` (standard Bootstrap traffic-light colors)

Create `requirements.txt` with pinned versions:
```
dash==4.0.0
dash-bootstrap-components==2.0.4
openpyxl==3.1.5
pandas==2.2.3
```
Note: Use pandas 2.2.3 (latest stable in pip). Do NOT use 2.3.3 (research doc may have a typo — verify with `pip index versions pandas` if needed, but 2.2.3 is safe).
  </action>
  <verify>
Run: `python -c "from src.config import SYSTEM_COLORS, DATA_FILE, RAG_COLORS; print(SYSTEM_COLORS); print(DATA_FILE); print(RAG_COLORS)"`
Confirm: Prints the color dicts and a valid Path to data.xlsx.
  </verify>
  <done>
SYSTEM_COLORS has three entries (Mechanical, Electrical, Hybrid) with hex color strings. DATA_FILE points to data.xlsx relative to project root. RAG_COLORS has red/yellow/green entries. requirements.txt lists four pinned dependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create data loader with section-based Excel parsing and validation</name>
  <files>
    src/data/loader.py
  </files>
  <action>
Create `src/data/loader.py` implementing the `load_data()` function that:

1. **Opens data.xlsx** using openpyxl (import path from `src.config.DATA_FILE`)
2. **Scans Sheet1 for section headers** by iterating column B (col 2) looking for these exact strings:
   - `"Electrical Components"` → key `"electrical"`
   - `"Mechanical Components"` → key `"mechanical"`
   - `"Miscalleneous"` → key `"miscellaneous"` (NOTE: the actual file has this typo — match it exactly)
3. **Validates all three sections found** — if any missing, raise `ValueError` with message naming the missing section(s)
4. **Parses each section** using a helper `_parse_section(ws, header_row, stop_rows)`:
   - Start at `header_row + 1`, read until a row in `stop_rows` is reached or cell in column B is `None`
   - Skip rows where column B value is `"Total"` (these are summary rows)
   - For each equipment row, extract columns B through G (positions 2-7):
     - col 2: `name` (str)
     - col 3: `quantity` (may be int, float, str like "~15 tons", or None — store as-is)
     - col 4: `cost_usd` (may be numeric or str like "$ 2500 per ton" — store as-is)
     - col 5: `energy_kw` (numeric or None)
     - col 6: `land_area_m2` (numeric or None)
     - col 7: `lifespan_years` (numeric, "indefinite" string, or other string — store as-is)
   - Convert list of dicts to `pd.DataFrame`
5. **Parses battery/tank lookup table**:
   - Header at row 3, columns J-P (10-16)
   - Data rows 4-14 (11 rows, battery fraction 0.0 to 1.0)
   - Columns: battery_fraction (J), tank_fraction (K), battery_kwh (L), tank_gal (M), battery_cost (N), tank_cost (O), total_cost (P)
   - Convert to `pd.DataFrame`
6. **Returns** a dict: `{"electrical": df, "mechanical": df, "miscellaneous": df, "battery_lookup": df}`
7. **Raises** `FileNotFoundError` if data.xlsx missing, `ValueError` if sections not found or parsing fails
8. **Logs** to console: print validation info (section found at row X, N equipment rows parsed) for terminal diagnostics

Important: Do NOT filter out row 33 (the merged-cell note) by checking for merged cells — just let the name-is-None check skip it naturally. Row 33's column B value may be None or part of a merged range; either way the `name is None` guard handles it.

Important: Do NOT call `pd.to_numeric()` or coerce any values. Store everything as-is from the Excel cells. Downstream phases handle numeric conversion.
  </action>
  <verify>
Run: `python -c "from src.data.loader import load_data; data = load_data(); print('Electrical:', len(data['electrical']), 'rows'); print('Mechanical:', len(data['mechanical']), 'rows'); print('Miscellaneous:', len(data['miscellaneous']), 'rows'); print('Battery lookup:', len(data['battery_lookup']), 'rows'); print(data['electrical'].columns.tolist()); print(data['miscellaneous'][['name','cost_usd','lifespan_years']].to_string())"`

Expected:
- Electrical: ~10 rows
- Mechanical: ~9 rows
- Miscellaneous: ~5-6 rows (depends on how row 33 note is handled)
- Battery lookup: 11 rows
- Columns include name, quantity, cost_usd, energy_kw, land_area_m2, lifespan_years
- Miscellaneous shows string values like "$ 2500 per ton" and "indefinite" preserved as-is
  </verify>
  <done>
`load_data()` returns four DataFrames with correct row counts. Non-numeric values are preserved as strings. Missing file raises FileNotFoundError. Missing sections raise ValueError with descriptive message. Console prints section validation info.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from src.config import SYSTEM_COLORS; print(SYSTEM_COLORS)"` prints three-entry dict
2. `python -c "from src.data.loader import load_data; d = load_data(); [print(k, len(v)) for k,v in d.items()]"` prints four DataFrames with expected row counts
3. Rename data.xlsx temporarily, run loader, confirm FileNotFoundError is raised (then rename back)
4. `cat requirements.txt` shows four pinned dependencies
</verification>

<success_criteria>
- load_data() parses all three sections from the single-sheet Excel file
- Battery lookup table parsed as separate DataFrame
- Non-numeric values (string costs, "indefinite", None) preserved without coercion
- Missing file or missing sections produce clear error messages
- SYSTEM_COLORS and RAG_COLORS defined with correct hex values
- requirements.txt pins dash, dash-bootstrap-components, openpyxl, pandas
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
