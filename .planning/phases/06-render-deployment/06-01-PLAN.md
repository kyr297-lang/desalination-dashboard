---
phase: 06-render-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app.py
  - requirements.txt
  - Procfile
  - .python-version
  - .gitignore
autonomous: true
requirements:
  - DEPLOY-01
  - DEPLOY-02
  - DEPLOY-03
  - DEPLOY-04

must_haves:
  truths:
    - "app.py exposes server = app.server at module level for gunicorn"
    - "Procfile declares web process with gunicorn app:server"
    - "requirements.txt includes gunicorn==25.1.0 with all deps pinned"
    - "data.xlsx is tracked by git (not gitignored)"
    - ".gitignore excludes __pycache__, ~$*, .venv, and IDE files"
  artifacts:
    - path: "app.py"
      provides: "WSGI server entry point"
      contains: "server = app.server"
    - path: "Procfile"
      provides: "Render process declaration"
      contains: "web: gunicorn app:server"
    - path: "requirements.txt"
      provides: "Pinned Python dependencies including gunicorn"
      contains: "gunicorn==25.1.0"
    - path: ".python-version"
      provides: "Python version pin for Render"
      contains: "3.14"
    - path: ".gitignore"
      provides: "Git exclusion rules"
      contains: "__pycache__"
  key_links:
    - from: "Procfile"
      to: "app.py"
      via: "gunicorn app:server references module-level server variable"
      pattern: "gunicorn app:server"
    - from: "app.py"
      to: "dash.Dash"
      via: "server = app.server exposes Flask WSGI callable"
      pattern: "server = app\\.server"
    - from: "requirements.txt"
      to: "Procfile"
      via: "gunicorn must be installed before Procfile start command works"
      pattern: "gunicorn"
---

<objective>
Prepare the codebase for Render deployment by adding the WSGI server entry point, Procfile, gunicorn dependency, Python version pin, and .gitignore.

Purpose: Make the existing Dash app deployable to Render free tier with a single git push workflow.
Output: All deployment-ready files in the repo — ready to push to GitHub and connect to Render.
</objective>

<execution_context>
@C:/Users/kevin/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/kevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-render-deployment/06-RESEARCH.md
@app.py
@requirements.txt
@src/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add WSGI entry point, Procfile, gunicorn dep, and deployment config files</name>
  <files>app.py, requirements.txt, Procfile, .python-version, .gitignore</files>
  <action>
1. **app.py** — Add `server = app.server` at module level, immediately after `app.title = "Wind-Powered Desalination Dashboard"` (line 55) and BEFORE `app.config.suppress_callback_exceptions = True`. Add a comment: `# WSGI entry point — exposes Flask server for gunicorn`. This line MUST NOT be inside the `if __name__ == "__main__":` block.

2. **requirements.txt** — Add `gunicorn==25.1.0` in alphabetical position (between `dash-bootstrap-components` and `openpyxl`). Keep all existing versions exactly as they are. Do NOT run pip freeze. Final content:
```
dash==4.0.0
dash-bootstrap-components==2.0.4
gunicorn==25.1.0
openpyxl==3.1.5
pandas==2.3.3
```

3. **Procfile** — Create file in repo root (capital P, no extension) with exactly:
```
web: gunicorn app:server --workers 2 --timeout 120
```
No trailing newline needed. Workers=2 is safe for Render free tier 512MB RAM. Timeout=120 is a conservative safety margin for initial data load.

4. **.python-version** — Create file in repo root with exactly:
```
3.14
```
This pins the Python major.minor version for Render. Do NOT use 3.14.3 — just the major.minor.

5. **.gitignore** — Create file in repo root with:
```gitignore
# Python
__pycache__/
*.py[cod]
*.pyo
.venv/
venv/
*.egg-info/

# Excel lock files
~$*

# OS
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
```
Important: Do NOT ignore `data.xlsx` — it must be committed per user decision. Do NOT ignore `.planning/` — keep it in the repo.
  </action>
  <verify>
    <automated>cd "C:/Users/kevin/Downloads/Desalination Project Vibe Code" && python -c "import app; assert hasattr(app, 'server'), 'server not found'; print('PASS: server exposed')" && test -f Procfile && grep -q "gunicorn app:server" Procfile && echo "PASS: Procfile valid" && grep -q "gunicorn==25.1.0" requirements.txt && echo "PASS: gunicorn in requirements" && test -f .python-version && echo "PASS: .python-version exists" && test -f .gitignore && grep -q "__pycache__" .gitignore && echo "PASS: .gitignore valid"</automated>
    <manual>Review app.py to confirm server = app.server is at module level, not inside if __name__ block</manual>
  </verify>
  <done>app.py has server = app.server at module level; Procfile exists with gunicorn app:server; requirements.txt includes gunicorn==25.1.0; .python-version pins 3.14; .gitignore excludes __pycache__ and ~$* but not data.xlsx</done>
</task>

<task type="auto">
  <name>Task 2: Verify data path and test gunicorn starts locally</name>
  <files>src/config.py</files>
  <action>
1. **Verify src/config.py** — Confirm `DATA_FILE = Path(__file__).parent.parent / "data.xlsx"` is present and correct. This already works for deployed environments per research. Do NOT modify this file.

2. **Verify data.xlsx is git-tracked** — Run `git ls-files data.xlsx` to confirm it is tracked. If not tracked, run `git add data.xlsx`.

3. **Test gunicorn locally** — Install gunicorn locally if on Linux/Mac, or validate the import chain works:
   - Run `python -c "from app import server; print(type(server))"` — should print `<class 'flask.app.Flask'>`.
   - This confirms gunicorn will be able to import the `server` object from `app.py`.

4. **Verify the full import chain succeeds** — Run `python -c "from app import server, DATA; assert server is not None; assert DATA is not None; print('PASS: app module fully loads with server and DATA')"` to confirm the app loads data and exposes server without errors.

Note: gunicorn itself cannot run on Windows, so we verify the import chain instead. The actual gunicorn startup will be verified on Render in Plan 02.
  </action>
  <verify>
    <automated>cd "C:/Users/kevin/Downloads/Desalination Project Vibe Code" && python -c "from app import server, DATA; assert server is not None, 'server is None'; assert DATA is not None, 'DATA is None'; print(f'PASS: server type={type(server).__name__}, DATA loaded')" && python -c "from src.config import DATA_FILE; assert DATA_FILE.exists(), f'data.xlsx not found at {DATA_FILE}'; print(f'PASS: data.xlsx exists at {DATA_FILE}')"</automated>
  </verify>
  <done>src/config.py pathlib path resolves correctly; data.xlsx is git-tracked; app module loads successfully with both server and DATA objects available</done>
</task>

</tasks>

<verification>
1. `python -c "import app; print(hasattr(app, 'server'))"` returns True
2. `grep "gunicorn" requirements.txt` shows `gunicorn==25.1.0`
3. `cat Procfile` shows `web: gunicorn app:server --workers 2 --timeout 120`
4. `cat .python-version` shows `3.14`
5. `git ls-files data.xlsx` shows `data.xlsx` (tracked)
6. `.gitignore` contains `__pycache__/` and `~$*`
</verification>

<success_criteria>
All four DEPLOY requirements are satisfied:
- DEPLOY-01: Procfile exists with gunicorn start command
- DEPLOY-02: app.py exposes server = app.server at module level
- DEPLOY-03: requirements.txt includes gunicorn==25.1.0 with all deps pinned
- DEPLOY-04: data.xlsx loads via pathlib path (pre-existing) and is git-tracked
</success_criteria>

<output>
After completion, create `.planning/phases/06-render-deployment/06-01-SUMMARY.md`
</output>
